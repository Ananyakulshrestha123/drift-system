/* REXX */
Address ISPEXEC

PDS_DSN = "YOUR.PDS.DATASET"  /* Replace with your PDS name */
dataid = "MYPDS"              /* Data ID for the PDS */
member = ""                   /* Member name variable */
listid = ""                   /* List ID for member list */
rc = 0                        /* Return code variable */
rec. = ""                     /* Stem variable to hold member records */

Say "Processing PDS:" PDS_DSN

/* 1. LMINIT: Generate a Data ID for the PDS */
"LMINIT DATAID("dataid") DATASET('"PDS_DSN"') ENQ(SHR)"
If rc > 0 Then Call Error_Routine "LMINIT failed for" PDS_DSN ", RC =" rc

/* 2. LMMLIST: Get the list of members in the PDS */
"LMMLIST DATAID("dataid") OPTION(LIST) MEMBER(member) STATS(NO) LISTID(listid)"
/* If you need member statistics, use STATS(YES) */

Do While rc = 0  /* Loop while LMMLIST returns members */
  Say "  Processing member:" member

  /* 3. LMOPEN: Open the current member for input */
  "LMOPEN DATAID("dataid") OPTION(INPUT)"
  If rc > 0 Then Call Error_Routine "LMOPEN failed for" member ", RC =" rc

  i = 0  /* Initialize line counter for the member */

  /* 4. LMGET: Read records from the member */
  "LMGET DATAID("dataid") MODE(LINE) TEXT(rec.line)"
  Do While rc = 0
    i = i + 1
    rec.i = rec.line
    Say "    Line " i ":" rec.i  /* Process the line here */
    "LMGET DATAID("dataid") MODE(LINE) TEXT(rec.line)"
  End
  rec.0 = i  /* Store the number of lines in rec.0 */

  Say "    Number of lines in" member ":" rec.0

  /* 5. LMCLOSE: Close the current member */
  "LMCLOSE DATAID("dataid")"
  If rc > 0 Then Call Error_Routine "LMCLOSE failed for" member ", RC =" rc

  /* 6. LMMLIST: Get the next member in the list */
  "LMMLIST DATAID("dataid") OPTION(LIST) MEMBER(member) STATS(NO)"
End

/* 7. LMFREE: Free the PDS allocation and Data ID */
"LMFREE DATAID("dataid")"
If rc > 0 Then Call Error_Routine "LMFREE failed for" PDS_DSN ", RC =" rc

Exit

/* Error handling routine */
Error_Routine:
  Say "ERROR:" Arg(1)
  Say "LMMLIST DATAID("dataid") OPTION(FREE)" /* Free the member list if it exists */
  "LMCLOSE DATAID("dataid")"
  "LMFREE DATAID("dataid")"
  Exit 8
